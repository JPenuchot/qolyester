<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Qolyester daemon: neighbors.hxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>neighbors.hxx</h1><a href="a00243.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (C) 2003-2009 Laboratoire de Recherche en Informatique</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">// This file is part of Qolyester.</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">// Qolyester is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">// modify it under the terms of the GNU General Public License</span>
<a name="l00007"></a>00007 <span class="comment">// as published by the Free Software Foundation; either version 2</span>
<a name="l00008"></a>00008 <span class="comment">// of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="comment">// Qolyester is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment">// GNU General Public License for more details.</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment">// along with this program; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment">// Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
<a name="l00018"></a>00018 <span class="comment">// Boston, MA  02110-1301, USA.</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#ifndef QOLYESTER_DAEMON_SET_NEIGHBORS_HXX</span>
<a name="l00021"></a><a class="code" href="a00243.html#71ce28333054aae1e794f44c380c31f2">00021</a> <span class="preprocessor"></span><span class="preprocessor"># define QOLYESTER_DAEMON_SET_NEIGHBORS_HXX 1</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="preprocessor"># include "<a class="code" href="a00229.html" title="Interface address to main node address translation.">alg/mainaddrof.hh</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor"># include "<a class="code" href="a00204.html" title="Graph-specific declarations.">gra/graph.hh</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor"># include "<a class="code" href="a00231.html">utl/mark.hh</a>"</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">namespace </span>olsr {
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   <span class="keyword">extern</span> <a class="code" href="a00289.html#4d2737a93322f19eedf93b0e33a9bd49">sched_t</a>        <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>;
<a name="l00030"></a>00030   <span class="keyword">extern</span> utl::Mark      <a class="code" href="a00289.html#93d438a99840d6124c2e415f4bc3c2a3">mprset_recomp</a>;
<a name="l00031"></a>00031   <span class="keyword">extern</span> utl::Mark      <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>;
<a name="l00032"></a><a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">00032</a>   <span class="keyword">extern</span> <a class="code" href="a00002.html" title="The graph per se.">pathnet_t</a>      <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>;
<a name="l00033"></a>00033   <span class="keyword">extern</span> <a class="code" href="a00013.html">cproxy_t</a>       <a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="keyword">namespace </span>set {
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor"># ifdef QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>    Link::LinkQuality::LinkQuality(Link&amp; i, <span class="keywordtype">float</span> v)
<a name="l00039"></a>00039       : value_(v),
<a name="l00040"></a>00040         instance_(i),
<a name="l00041"></a>00041         expired_(0),
<a name="l00042"></a>00042         blocked_(<span class="keyword">false</span>) {
<a name="l00043"></a>00043       assert(0.f &lt;= v &amp;&amp; v &lt;= 1.f);
<a name="l00044"></a>00044     }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     Link::LinkQuality&amp;
<a name="l00047"></a>00047     Link::LinkQuality::operator++() {
<a name="l00048"></a>00048 <span class="comment">//       blocked_ = true;</span>
<a name="l00049"></a>00049       <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; <a class="code" href="a00307.html#6546449b7bae4cab8f39d42eef25b1c7">up</a> &lt;&lt; <span class="stringliteral">"LinkQuality::++(): "</span>
<a name="l00050"></a>00050             &lt;&lt; instance_.local_addr() &lt;&lt; <span class="stringliteral">" -&gt; "</span> &lt;&lt; instance_.remote_addr()
<a name="l00051"></a>00051             &lt;&lt; <span class="charliteral">' '</span> &lt;&lt; of(value_) &lt;&lt; <span class="stringliteral">" -&gt; "</span>;
<a name="l00052"></a>00052       value_ *= 1 - cst::hyst_scaling;
<a name="l00053"></a>00053       value_ += cst::hyst_scaling;
<a name="l00054"></a>00054       <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; of(value_) &lt;&lt; std::endl &lt;&lt; <a class="code" href="a00307.html#abc975b2fb3a67376993e861d6b0f262">down</a>;
<a name="l00055"></a>00055       update();
<a name="l00056"></a>00056       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00057"></a>00057     }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     Link::LinkQuality&amp;
<a name="l00060"></a>00060     Link::LinkQuality::operator--() {
<a name="l00061"></a>00061       <span class="keywordflow">if</span> (blocked_) {
<a name="l00062"></a>00062         <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; <a class="code" href="a00307.html#6546449b7bae4cab8f39d42eef25b1c7">up</a> &lt;&lt; <span class="stringliteral">"LinkQuality::--(): "</span>
<a name="l00063"></a>00063               &lt;&lt; instance_.local_addr() &lt;&lt; <span class="stringliteral">" -&gt; "</span> &lt;&lt; instance_.remote_addr()
<a name="l00064"></a>00064               &lt;&lt; <span class="charliteral">' '</span> &lt;&lt; of(value_) &lt;&lt; <span class="stringliteral">" not changed since blocked"</span>
<a name="l00065"></a>00065               &lt;&lt; std::endl &lt;&lt; <a class="code" href="a00307.html#abc975b2fb3a67376993e861d6b0f262">down</a>;
<a name="l00066"></a>00066         blocked_ = <span class="keyword">false</span>;
<a name="l00067"></a>00067         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00068"></a>00068       }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070       <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; <a class="code" href="a00307.html#6546449b7bae4cab8f39d42eef25b1c7">up</a> &lt;&lt; <span class="stringliteral">"LinkQuality::--(): "</span>
<a name="l00071"></a>00071             &lt;&lt; instance_.local_addr() &lt;&lt; <span class="stringliteral">" -&gt; "</span> &lt;&lt; instance_.remote_addr()
<a name="l00072"></a>00072             &lt;&lt; <span class="charliteral">' '</span> &lt;&lt; of(value_) &lt;&lt; <span class="stringliteral">" -&gt; "</span>;
<a name="l00073"></a>00073       value_ *= 1 - cst::hyst_scaling;
<a name="l00074"></a>00074       <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; of(value_) &lt;&lt; std::endl &lt;&lt; <a class="code" href="a00307.html#abc975b2fb3a67376993e861d6b0f262">down</a>;
<a name="l00075"></a>00075       update();
<a name="l00076"></a>00076       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keywordtype">void</span>
<a name="l00080"></a>00080     Link::LinkQuality:: update() {
<a name="l00081"></a>00081       <span class="keywordflow">if</span> (value_ &gt; cst::hyst_threshold_high) {
<a name="l00082"></a>00082         instance_.set_pending(<span class="keyword">false</span>);
<a name="l00083"></a>00083         instance_.set_losttime(<a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() - 1000);
<a name="l00084"></a>00084       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value_ &lt; cst::hyst_threshold_low &amp;&amp; !instance_.pending()) {
<a name="l00085"></a>00085         instance_.set_pending(<span class="keyword">true</span>);
<a name="l00086"></a>00086         instance_.set_losttime(<a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() + <a class="code" href="a00292.html#0608ffabb7d5aa9554f920f8af7758e7">cst::neighb_hold_time</a>);
<a name="l00087"></a>00087         <span class="keywordflow">if</span> (instance_.time() &lt; instance_.losttime())
<a name="l00088"></a>00088           instance_.set_losttime(instance_.time());
<a name="l00089"></a>00089       } <span class="comment">/* else {} */</span>
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     Link::Link()
<a name="l00093"></a>00093       : l_addr_(),
<a name="l00094"></a>00094         r_addr_(),
<a name="l00095"></a>00095         m_addr_(),
<a name="l00096"></a>00096         asymtime_(0),
<a name="l00097"></a>00097         symtime_(0),
<a name="l00098"></a>00098         time_(0),
<a name="l00099"></a>00099         was_sym_(<span class="keyword">false</span>),
<a name="l00100"></a>00100         losttime_(0),
<a name="l00101"></a>00101         nexttime_(0),
<a name="l00102"></a>00102         htime_(0),
<a name="l00103"></a>00103         pending_(<span class="keyword">false</span>),
<a name="l00104"></a>00104         quality_(*<span class="keyword">this</span>, 0),
<a name="l00105"></a>00105         last_seqnum_(0)
<a name="l00106"></a>00106     {}
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     Link::Link(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; l, <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; r, <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; m,
<a name="l00109"></a>00109                <span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp; v, <span class="keyword">const</span> <a class="code" href="a00151.html">seqnum_t</a>&amp; s, <span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp; ht)
<a name="l00110"></a>00110       : l_addr_(l),
<a name="l00111"></a>00111         r_addr_(r),
<a name="l00112"></a>00112         m_addr_(m),
<a name="l00113"></a>00113         asymtime_(0),
<a name="l00114"></a>00114         symtime_(<a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() - 1000),
<a name="l00115"></a>00115         time_(<a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(v)),
<a name="l00116"></a>00116         was_sym_(<span class="keyword">false</span>),
<a name="l00117"></a>00117         losttime_(<a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() - 1000),
<a name="l00118"></a>00118         nexttime_(<a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() - 1000),
<a name="l00119"></a>00119         htime_(ht),
<a name="l00120"></a>00120         pending_(<span class="keyword">true</span>),
<a name="l00121"></a>00121         quality_(*<span class="keyword">this</span>),
<a name="l00122"></a>00122         last_seqnum_(s)
<a name="l00123"></a>00123     {}
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     Link::Link(<span class="keyword">const</span> This&amp; other)
<a name="l00126"></a>00126       : Super(other),
<a name="l00127"></a>00127         l_addr_(other.l_addr_),
<a name="l00128"></a>00128         r_addr_(other.r_addr_),
<a name="l00129"></a>00129         m_addr_(other.m_addr_),
<a name="l00130"></a>00130         asymtime_(other.asymtime_),
<a name="l00131"></a>00131         symtime_(other.symtime_),
<a name="l00132"></a>00132         time_(other.time_),
<a name="l00133"></a>00133         was_sym_(other.was_sym_),
<a name="l00134"></a>00134         losttime_(other.losttime_),
<a name="l00135"></a>00135         nexttime_(other.nexttime_),
<a name="l00136"></a>00136         htime_(other.htime_),
<a name="l00137"></a>00137         pending_(other.pending_),
<a name="l00138"></a>00138         quality_(*<span class="keyword">this</span>, other.quality_),
<a name="l00139"></a>00139         last_seqnum_(other.last_seqnum_)
<a name="l00140"></a>00140     {}
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="keywordtype">void</span>
<a name="l00143"></a>00143     Link::set_last_seqnum(<span class="keyword">const</span> <a class="code" href="a00151.html">seqnum_t</a>&amp; s) {
<a name="l00144"></a>00144       <span class="keywordflow">if</span> (s != ++last_seqnum_) {
<a name="l00145"></a>00145         <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; <span class="stringliteral">"--quality("</span> &lt;&lt; m_addr_ &lt;&lt; <span class="stringliteral">"): lost packet (expected "</span>
<a name="l00146"></a>00146               &lt;&lt; last_seqnum_ &lt;&lt; <span class="stringliteral">", but got "</span> &lt;&lt; s &lt;&lt; <span class="charliteral">')'</span> &lt;&lt; std::endl;
<a name="l00147"></a>00147         quality_.lost(s &gt; last_seqnum_ ? s - last_seqnum_ : 0);
<a name="l00148"></a>00148         --quality_;
<a name="l00149"></a>00149         <a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>.<a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(<a class="code" href="a00289.html#db39684ca004e3fd7408686f01c1dbff">main_addr</a>());
<a name="l00150"></a>00150         last_seqnum_ = s;
<a name="l00151"></a>00151       } <span class="keywordflow">else</span>
<a name="l00152"></a>00152         quality_.lost(0);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154       ++quality_;
<a name="l00155"></a>00155       <a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>.<a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(<a class="code" href="a00289.html#db39684ca004e3fd7408686f01c1dbff">main_addr</a>());
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157 <span class="preprocessor"># else // !QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00158"></a><a class="code" href="a00070.html#cbd2c25cde88586a3de641ce3f01c87f">00158</a> <span class="preprocessor"></span>    Link::Link()
<a name="l00159"></a>00159       : l_addr_(),
<a name="l00160"></a>00160         r_addr_(),
<a name="l00161"></a>00161         m_addr_(),
<a name="l00162"></a>00162         asymtime_(0),
<a name="l00163"></a>00163         symtime_(0),
<a name="l00164"></a>00164         time_(0),
<a name="l00165"></a>00165         was_sym_(false)
<a name="l00166"></a>00166     {}
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="a00070.html#19b7242ee5a642e668381755ac290b49">00168</a>     <a class="code" href="a00070.html#cbd2c25cde88586a3de641ce3f01c87f">Link::Link</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; l, <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; r, <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; m,
<a name="l00169"></a>00169                <span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp; v)
<a name="l00170"></a>00170       : <a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>(l),
<a name="l00171"></a>00171         <a class="code" href="a00070.html#fa77717d6c8dcc53f4eefaede07b2ce3">r_addr_</a>(r),
<a name="l00172"></a>00172         <a class="code" href="a00070.html#4620fff5ae199ef52175581b28f88a69">m_addr_</a>(m),
<a name="l00173"></a>00173         <a class="code" href="a00070.html#3130a47c1194e6bc7ea7464460e0873b">asymtime_</a>(0),
<a name="l00174"></a>00174         <a class="code" href="a00070.html#25a585b7f81a91e75d90912f8a082957">symtime_</a>(<a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>::now() - 1000),
<a name="l00175"></a>00175         <a class="code" href="a00070.html#1fb4a9c33558de8c72d12fcda0a549e8">time_</a>(<a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>::in(v)),
<a name="l00176"></a>00176         <a class="code" href="a00070.html#7273bc9ed271489889dd5b0d8f6d28e4">was_sym_</a>(false)
<a name="l00177"></a>00177     {}
<a name="l00178"></a>00178 
<a name="l00179"></a><a class="code" href="a00070.html#11c56d797ee205e20e5ef7f18ce43153">00179</a>     <a class="code" href="a00070.html#cbd2c25cde88586a3de641ce3f01c87f">Link::Link</a>(<span class="keyword">const</span> <a class="code" href="a00070.html">This</a>&amp; other)
<a name="l00180"></a>00180       : <a class="code" href="a00088.html">Super</a>(other),
<a name="l00181"></a>00181         <a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>(other.<a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>),
<a name="l00182"></a>00182         <a class="code" href="a00070.html#fa77717d6c8dcc53f4eefaede07b2ce3">r_addr_</a>(other.<a class="code" href="a00070.html#fa77717d6c8dcc53f4eefaede07b2ce3">r_addr_</a>),
<a name="l00183"></a>00183         <a class="code" href="a00070.html#4620fff5ae199ef52175581b28f88a69">m_addr_</a>(other.<a class="code" href="a00070.html#4620fff5ae199ef52175581b28f88a69">m_addr_</a>),
<a name="l00184"></a>00184         <a class="code" href="a00070.html#3130a47c1194e6bc7ea7464460e0873b">asymtime_</a>(other.<a class="code" href="a00070.html#3130a47c1194e6bc7ea7464460e0873b">asymtime_</a>),
<a name="l00185"></a>00185         <a class="code" href="a00070.html#25a585b7f81a91e75d90912f8a082957">symtime_</a>(other.<a class="code" href="a00070.html#25a585b7f81a91e75d90912f8a082957">symtime_</a>),
<a name="l00186"></a>00186         <a class="code" href="a00070.html#1fb4a9c33558de8c72d12fcda0a549e8">time_</a>(other.<a class="code" href="a00070.html#1fb4a9c33558de8c72d12fcda0a549e8">time_</a>),
<a name="l00187"></a>00187         <a class="code" href="a00070.html#7273bc9ed271489889dd5b0d8f6d28e4">was_sym_</a>(other.<a class="code" href="a00070.html#7273bc9ed271489889dd5b0d8f6d28e4">was_sym_</a>)
<a name="l00188"></a>00188     {}
<a name="l00189"></a>00189 <span class="preprocessor"># endif</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>
<a name="l00191"></a>00191     <span class="comment">// Simple validity checker</span>
<a name="l00192"></a>00192     <span class="keywordtype">bool</span>
<a name="l00193"></a><a class="code" href="a00070.html#a4984fa0bde3fba1b7aa345467bf9450">00193</a>     <a class="code" href="a00070.html#a4984fa0bde3fba1b7aa345467bf9450">Link::is_valid</a>()<span class="keyword">    const </span>{ <span class="keywordflow">return</span> !<a class="code" href="a00070.html#1fb4a9c33558de8c72d12fcda0a549e8">time_</a>.<a class="code" href="a00170.html#8ad17ad0c2e467bf604bfbd9c02e7468">is_past</a>(); }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordtype">bool</span>
<a name="l00196"></a><a class="code" href="a00070.html#396a28a3960e0aa0e52e1bf7b2702aea">00196</a>     <a class="code" href="a00070.html#396a28a3960e0aa0e52e1bf7b2702aea">Link::is_sym</a>()<span class="keyword">      const </span>{
<a name="l00197"></a>00197 <span class="preprocessor"># ifdef QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span>      <span class="keywordflow">return</span> losttime_.is_past() &amp;&amp; !pending_ &amp;&amp; !<a class="code" href="a00070.html#25a585b7f81a91e75d90912f8a082957">symtime_</a>.<a class="code" href="a00170.html#8ad17ad0c2e467bf604bfbd9c02e7468">is_past</a>();
<a name="l00199"></a>00199 <span class="preprocessor"># else // !QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>      <span class="keywordflow">return</span> !<a class="code" href="a00070.html#25a585b7f81a91e75d90912f8a082957">symtime_</a>.<a class="code" href="a00170.html#8ad17ad0c2e467bf604bfbd9c02e7468">is_past</a>();
<a name="l00201"></a>00201 <span class="preprocessor"># endif</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>    }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="comment">// Plain comparison operator</span>
<a name="l00205"></a>00205     <span class="keywordtype">bool</span>
<a name="l00206"></a><a class="code" href="a00070.html#3ca8df70a027d425e2c0387133779af5">00206</a>     <a class="code" href="a00070.html#3ca8df70a027d425e2c0387133779af5">Link::operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="a00070.html">This</a>&amp; rhs)<span class="keyword"> const </span>{
<a name="l00207"></a>00207       <span class="keywordflow">if</span> (<a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a> == rhs.<a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>)
<a name="l00208"></a>00208         <span class="keywordflow">return</span> <a class="code" href="a00070.html#fa77717d6c8dcc53f4eefaede07b2ce3">r_addr_</a> &lt; rhs.<a class="code" href="a00070.html#fa77717d6c8dcc53f4eefaede07b2ce3">r_addr_</a>;
<a name="l00209"></a>00209       <span class="keywordflow">return</span> <a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a> &lt; rhs.<a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>;
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="comment">// Utility static method for the creation of dummy objects to search sets</span>
<a name="l00213"></a>00213     <span class="keyword">const</span> <a class="code" href="a00070.html">Link</a>&amp;
<a name="l00214"></a><a class="code" href="a00070.html#88e9aea357945edcadc1c61e7fbeef39">00214</a>     <a class="code" href="a00070.html#88e9aea357945edcadc1c61e7fbeef39">Link::make_key</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; local, <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; remote) {
<a name="l00215"></a>00215       <span class="keyword">const_cast&lt;</span><a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00070.html#d64a7ecd1b87a94f9610cfd330ae6fa2">dummy_for_find_</a>.<a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>) = local;
<a name="l00216"></a>00216       <span class="keyword">const_cast&lt;</span><a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00070.html#d64a7ecd1b87a94f9610cfd330ae6fa2">dummy_for_find_</a>.<a class="code" href="a00070.html#fa77717d6c8dcc53f4eefaede07b2ce3">r_addr_</a>) = remote;
<a name="l00217"></a>00217       <span class="keywordflow">return</span> <a class="code" href="a00070.html#d64a7ecd1b87a94f9610cfd330ae6fa2">dummy_for_find_</a>;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keyword">const</span> <a class="code" href="a00070.html">Link</a>&amp;
<a name="l00221"></a><a class="code" href="a00070.html#7624cdb3c075cc76cd3722eea562a68d">00221</a>     <a class="code" href="a00070.html#7624cdb3c075cc76cd3722eea562a68d">Link::make_key_local</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; local) {
<a name="l00222"></a>00222       <span class="keyword">const_cast&lt;</span><a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00070.html#d64a7ecd1b87a94f9610cfd330ae6fa2">dummy_for_find_</a>.<a class="code" href="a00070.html#89006037639d1e46660ec5d60a01e495">l_addr_</a>) = local;
<a name="l00223"></a>00223       <span class="keywordflow">return</span> <a class="code" href="a00070.html#d64a7ecd1b87a94f9610cfd330ae6fa2">dummy_for_find_</a>;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="keyword">namespace </span>upd {
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="keywordtype">void</span>
<a name="l00229"></a><a class="code" href="a00071.html#25219eeabf8c953959548d7e2bb08586">00229</a>       LinkUpdater::operator()() {
<a name="l00230"></a>00230 <span class="preprocessor"># ifdef QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00231"></a>00231 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;nexttime().is_past()) {
<a name="l00232"></a>00232           <a class="code" href="a00289.html#b370cec80a2baa68bd0e422ed25b36c0">debug</a> &lt;&lt; <a class="code" href="a00307.html#6546449b7bae4cab8f39d42eef25b1c7">up</a> &lt;&lt; <span class="stringliteral">"--quality("</span> &lt;&lt; <a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;main_addr()
<a name="l00233"></a>00233                 &lt;&lt; <span class="stringliteral">"): expired nexttime by "</span>
<a name="l00234"></a>00234                 &lt;&lt; <a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;nexttime().diff() &lt;&lt; std::endl &lt;&lt; <a class="code" href="a00307.html#abc975b2fb3a67376993e861d6b0f262">down</a>;
<a name="l00235"></a>00235           <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">elem_t</a>&amp;<span class="keyword">&gt;</span>(*iter_).quality().expire();
<a name="l00236"></a>00236           --<span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">elem_t</a>&amp;<span class="keyword">&gt;</span>(*iter_).quality();
<a name="l00237"></a>00237           <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">elem_t</a>&amp;<span class="keyword">&gt;</span>(*iter_).set_nexttime(<a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;nexttime() +
<a name="l00238"></a>00238                                                    <a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;htime() *
<a name="l00239"></a>00239                                                    <a class="code" href="a00292.html#2f9a6c5cf6c5a6d55d01af68546d82c7">cst::hello_grace</a>);
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241 <span class="preprocessor"># endif // !QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;is_valid()) {
<a name="l00243"></a>00243           <a class="code" href="a00071.html#079edc1fff414e760ba64e3d5ae917e1">set_</a>.<a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(<a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;main_addr());
<a name="l00244"></a>00244           <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*      e = <a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>-&gt;updater();
<a name="l00245"></a>00245           <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#f41e7209a003243d0e0b15acc7ccf4d4">erase</a>(e);
<a name="l00246"></a>00246           e-&gt;<a class="code" href="a00168.html#3188e11b0e793a3c11b2018a25263942">set_next</a>(<a class="code" href="a00071.html#ec1096837ce2ad5f8a17b684eeafdfec">min_time</a>(*<a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>));
<a name="l00247"></a>00247           <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#98a2a5559ea1adb7bce7cc0e0609db5c">insert</a>(e);
<a name="l00248"></a>00248         } <span class="keywordflow">else</span>
<a name="l00249"></a>00249           <a class="code" href="a00071.html#079edc1fff414e760ba64e3d5ae917e1">set_</a>.<a class="code" href="a00013.html#1b8ee0360f50ac3dd0df8cc924be058e">erase</a>(<a class="code" href="a00071.html#1c5676cf537b82780917d89966596815">iter_</a>);
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     } <span class="comment">// namespace upd</span>
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="comment">//********************************</span>
<a name="l00255"></a>00255     <span class="comment">//*  The Neighbor class</span>
<a name="l00256"></a>00256     <span class="comment">//*</span>
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="a00093.html#f631b694a1fc43db889f3a4bf0f84459">00258</a>     <a class="code" href="a00093.html#f631b694a1fc43db889f3a4bf0f84459">Neighbor::Neighbor</a>()
<a name="l00259"></a>00259       : m_addr_(),
<a name="l00260"></a>00260         lset_(),
<a name="l00261"></a>00261         val_lset_(*this, lset_),
<a name="l00262"></a>00262         sym_(false),
<a name="l00263"></a>00263         mpr_(false),
<a name="l00264"></a>00264         mprsel_time_(0, 0),
<a name="l00265"></a>00265         was_mprsel_(false),
<a name="l00266"></a>00266         willingness_(0)
<a name="l00267"></a>00267     {}
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="a00093.html#4e6051137ce72c83a3c33469aebdab3b">00269</a>     <a class="code" href="a00093.html#f631b694a1fc43db889f3a4bf0f84459">Neighbor::Neighbor</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; maddr,
<a name="l00270"></a>00270                        <span class="keyword">const</span> std::set&lt;ulink_t&gt;::iterator&amp; i,
<a name="l00271"></a>00271                        <span class="keywordtype">unsigned</span> w)
<a name="l00272"></a>00272       : <a class="code" href="a00093.html#a4b38ca34feedee9044e957e29cf1c31">m_addr_</a>(maddr),
<a name="l00273"></a>00273         <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>(),
<a name="l00274"></a>00274         <a class="code" href="a00093.html#ebae42b34a1ba6080d438cc987da1ce2">val_lset_</a>(*this, <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>),
<a name="l00275"></a>00275         <a class="code" href="a00093.html#0af8048c3e276d923d45418282525801">sym_</a>(false),
<a name="l00276"></a>00276         <a class="code" href="a00093.html#bcc39390ea6ad2c1a1ae468b0c82c303">mpr_</a>(false),
<a name="l00277"></a>00277         <a class="code" href="a00093.html#c5f29444275ef7c9a014f141580a0f06">mprsel_time_</a>(<a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>::now() - 1000),
<a name="l00278"></a>00278         <a class="code" href="a00093.html#562cf6b5084face6a8a372824b214b00">was_mprsel_</a>(false),
<a name="l00279"></a>00279         <a class="code" href="a00093.html#38fbd91b7fdfe4229a2aa118a0cbdf84">willingness_</a>(w) {
<a name="l00280"></a>00280       <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>.insert(i);
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="a00093.html#fcdf8513a2f89e2ac4b607e346c671f5">00283</a>     <a class="code" href="a00093.html#f631b694a1fc43db889f3a4bf0f84459">Neighbor::Neighbor</a>(<span class="keyword">const</span> <a class="code" href="a00093.html">This</a>&amp; other)
<a name="l00284"></a>00284       : <a class="code" href="a00088.html">Super</a>(other),
<a name="l00285"></a>00285         <a class="code" href="a00093.html#a4b38ca34feedee9044e957e29cf1c31">m_addr_</a>(other.<a class="code" href="a00093.html#a4b38ca34feedee9044e957e29cf1c31">m_addr_</a>),
<a name="l00286"></a>00286         <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>(other.<a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>),
<a name="l00287"></a>00287         <a class="code" href="a00093.html#ebae42b34a1ba6080d438cc987da1ce2">val_lset_</a>(*this, <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>),
<a name="l00288"></a>00288         <a class="code" href="a00093.html#0af8048c3e276d923d45418282525801">sym_</a>(other.<a class="code" href="a00093.html#0af8048c3e276d923d45418282525801">sym_</a>),
<a name="l00289"></a>00289         <a class="code" href="a00093.html#bcc39390ea6ad2c1a1ae468b0c82c303">mpr_</a>(other.<a class="code" href="a00093.html#bcc39390ea6ad2c1a1ae468b0c82c303">mpr_</a>),
<a name="l00290"></a>00290         <a class="code" href="a00093.html#c5f29444275ef7c9a014f141580a0f06">mprsel_time_</a>(other.<a class="code" href="a00093.html#c5f29444275ef7c9a014f141580a0f06">mprsel_time_</a>),
<a name="l00291"></a>00291         <a class="code" href="a00093.html#562cf6b5084face6a8a372824b214b00">was_mprsel_</a>(other.<a class="code" href="a00093.html#562cf6b5084face6a8a372824b214b00">was_mprsel_</a>),
<a name="l00292"></a>00292         <a class="code" href="a00093.html#38fbd91b7fdfe4229a2aa118a0cbdf84">willingness_</a>(other.<a class="code" href="a00093.html#38fbd91b7fdfe4229a2aa118a0cbdf84">willingness_</a>)
<a name="l00293"></a>00293     {}
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="keywordtype">void</span>
<a name="l00296"></a><a class="code" href="a00093.html#72ac3b5d8671738b0683bfc3ab54026d">00296</a>     <a class="code" href="a00093.html#72ac3b5d8671738b0683bfc3ab54026d">Neighbor::set_willingness</a>(<span class="keywordtype">unsigned</span> w) {
<a name="l00297"></a>00297       <a class="code" href="a00093.html#38fbd91b7fdfe4229a2aa118a0cbdf84">willingness_</a> = w;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordtype">bool</span>
<a name="l00301"></a><a class="code" href="a00093.html#ee3c73c739c73658cf209c71ddd1a2e0">00301</a>     <a class="code" href="a00093.html#ee3c73c739c73658cf209c71ddd1a2e0">Neighbor::is_mprsel</a>()<span class="keyword"> const </span>{
<a name="l00302"></a>00302       <span class="keywordflow">return</span> !<a class="code" href="a00093.html#c5f29444275ef7c9a014f141580a0f06">mprsel_time_</a>.<a class="code" href="a00170.html#8ad17ad0c2e467bf604bfbd9c02e7468">is_past</a>();
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="keywordtype">bool</span>
<a name="l00306"></a><a class="code" href="a00093.html#d2c70d2710fd695703e7f0a2f2aa1c72">00306</a>     <a class="code" href="a00093.html#d2c70d2710fd695703e7f0a2f2aa1c72">Neighbor::was_mprsel</a>() {
<a name="l00307"></a>00307       <span class="keywordflow">if</span> (<a class="code" href="a00093.html#562cf6b5084face6a8a372824b214b00">was_mprsel_</a>) {
<a name="l00308"></a>00308         <a class="code" href="a00093.html#562cf6b5084face6a8a372824b214b00">was_mprsel_</a> = <span class="keyword">false</span>;
<a name="l00309"></a>00309         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00310"></a>00310       }
<a name="l00311"></a>00311       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordtype">void</span>
<a name="l00315"></a><a class="code" href="a00093.html#e09a69fe688fa4789c83720da0306745">00315</a>     <a class="code" href="a00093.html#e09a69fe688fa4789c83720da0306745">Neighbor::set_mprsel</a>(<span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp; validity) {
<a name="l00316"></a>00316       <a class="code" href="a00093.html#c5f29444275ef7c9a014f141580a0f06">mprsel_time_</a> = <a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(validity);
<a name="l00317"></a>00317       <span class="keywordflow">if</span> (<a class="code" href="a00093.html#ee3c73c739c73658cf209c71ddd1a2e0">is_mprsel</a>())
<a name="l00318"></a>00318         <a class="code" href="a00093.html#562cf6b5084face6a8a372824b214b00">was_mprsel_</a> = <span class="keyword">true</span>;
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="keywordtype">void</span>
<a name="l00322"></a><a class="code" href="a00093.html#8a9eff1582d6898101f7547b0e55cff1">00322</a>     <a class="code" href="a00093.html#8a9eff1582d6898101f7547b0e55cff1">Neighbor::unset_mprsel</a>() {
<a name="l00323"></a>00323       <a class="code" href="a00093.html#c5f29444275ef7c9a014f141580a0f06">mprsel_time_</a> = <a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() - 1000;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     std::pair&lt;<a class="code" href="a00023.html">Neighbor::linkset_t::const_iterator</a>,
<a name="l00327"></a>00327               <a class="code" href="a00023.html">Neighbor::linkset_t::const_iterator</a>&gt;
<a name="l00328"></a><a class="code" href="a00093.html#9d7c4002cd756cd5750d46d842189714">00328</a>     <a class="code" href="a00093.html#9d7c4002cd756cd5750d46d842189714">Neighbor::find_lifaces</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; laddr)<span class="keyword"> const </span>{
<a name="l00329"></a>00329       <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><a class="code" href="a00162.html">linkset_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00093.html#ebae42b34a1ba6080d438cc987da1ce2">val_lset_</a>).equal_range(<a class="code" href="a00070.html#7624cdb3c075cc76cd3722eea562a68d">Link::make_key_local</a>(laddr));
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="comment">//     Neighbor::linkset_t::const_iterator</span>
<a name="l00333"></a>00333 <span class="comment">//     Neighbor::find_liface(const address_t&amp; laddr) const {</span>
<a name="l00334"></a>00334 <span class="comment">//       return const_cast&lt;linkset_t&amp;&gt;(val_lset_).find(Link::make_key_local(laddr));</span>
<a name="l00335"></a>00335 <span class="comment">//     }</span>
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="comment">//     bool</span>
<a name="l00338"></a>00338 <span class="comment">//     Neighbor::is_liface(const address_t&amp; iaddr) const {</span>
<a name="l00339"></a>00339 <span class="comment">//       return find_liface(iaddr) != const_cast&lt;linkset_t&amp;&gt;(val_lset_).end();</span>
<a name="l00340"></a>00340 <span class="comment">//     }</span>
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="keywordtype">void</span>
<a name="l00343"></a><a class="code" href="a00093.html#adb479e2758f789946919941a45d4687">00343</a>     <a class="code" href="a00093.html#adb479e2758f789946919941a45d4687">Neighbor::insert</a>(<span class="keyword">const</span> std::set&lt;ulink_t&gt;::iterator&amp; pos) {
<a name="l00344"></a>00344       <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>.insert(pos);
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordtype">void</span>
<a name="l00348"></a><a class="code" href="a00093.html#8e807486e28a3331ea437d02fb9090bf">00348</a>     <a class="code" href="a00093.html#8e807486e28a3331ea437d02fb9090bf">Neighbor::erase</a>(<span class="keyword">const</span> lset_t::iterator&amp; pos) {
<a name="l00349"></a>00349       <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>.erase(pos);
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="keywordtype">void</span>
<a name="l00353"></a><a class="code" href="a00093.html#e7290c71771c5a3ba3053f574b3c2142">00353</a>     <a class="code" href="a00093.html#8e807486e28a3331ea437d02fb9090bf">Neighbor::erase</a>(<span class="keyword">const</span> std::set&lt;ulink_t&gt;::iterator&amp; pos) {
<a name="l00354"></a>00354       <a class="code" href="a00093.html#c74e1c61a6545137c9b5f2799725aa57">lset_</a>.erase(pos);
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="keywordtype">bool</span>
<a name="l00358"></a><a class="code" href="a00093.html#6eb6566c17e4b6c831b452e92d38ef44">00358</a>     <a class="code" href="a00093.html#6eb6566c17e4b6c831b452e92d38ef44">Neighbor::operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="a00093.html">This</a>&amp; rhs)<span class="keyword"> const </span>{
<a name="l00359"></a>00359       <span class="keywordflow">return</span> <a class="code" href="a00093.html#a4b38ca34feedee9044e957e29cf1c31">m_addr_</a> &lt; rhs.<a class="code" href="a00093.html#a4b38ca34feedee9044e957e29cf1c31">m_addr_</a>;
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keyword">const</span> <a class="code" href="a00093.html">Neighbor</a>&amp;
<a name="l00363"></a><a class="code" href="a00093.html#583ed09ee37bafb0a24c0e0570a53bc9">00363</a>     <a class="code" href="a00093.html#583ed09ee37bafb0a24c0e0570a53bc9">Neighbor::make_key</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; m) {
<a name="l00364"></a>00364       <span class="keyword">const_cast&lt;</span><a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00093.html#d3b373da423c2a8f9cbd4864fe2881c3">dummy_for_find_</a>.<a class="code" href="a00093.html#a4b38ca34feedee9044e957e29cf1c31">m_addr_</a>) = m;
<a name="l00365"></a>00365       <span class="keywordflow">return</span> <a class="code" href="a00093.html#d3b373da423c2a8f9cbd4864fe2881c3">dummy_for_find_</a>;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="keyword">namespace </span>upd {
<a name="l00369"></a>00369 
<a name="l00370"></a>00370       <span class="keywordtype">void</span>
<a name="l00371"></a><a class="code" href="a00096.html#55a21d68e0c8c741421835010faa9ab4">00371</a>       NeighborUpdater::operator()() {
<a name="l00372"></a>00372         <a class="code" href="a00096.html#6dc19034174b3edb7191ed5d1a4e8e17">set_</a>.<a class="code" href="a00013.html#597f13bc32f98e0231df67cfcb8a9fd5">unset_mprsel</a>(<a class="code" href="a00096.html#3529f97eff13da00fe37c4379dd9fafb">iter_</a>);
<a name="l00373"></a>00373       }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     } <span class="comment">// namespace upd</span>
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="a00013.html#abc585320cf511e687dce25f5c57f683">00377</a>     <a class="code" href="a00013.html#abc585320cf511e687dce25f5c57f683">CoherenceProxy::CoherenceProxy</a>()
<a name="l00378"></a>00378       : lset_(),
<a name="l00379"></a>00379         nset_(),
<a name="l00380"></a>00380         linkset_(lset_),
<a name="l00381"></a>00381         idx_lset_(lset_),
<a name="l00382"></a>00382         hello_linkset_(idx_lset_),
<a name="l00383"></a>00383         neighborset_(*this, nset_),
<a name="l00384"></a>00384         sym_neighborset_(neighborset_),
<a name="l00385"></a>00385         idx_nset_(nset_),
<a name="l00386"></a>00386         val_idx_nset_(*this, idx_nset_),
<a name="l00387"></a>00387         tc_neighborset_(val_idx_nset_),
<a name="l00388"></a>00388         advset_seqnum_(0),
<a name="l00389"></a>00389         advset_changed_(false),
<a name="l00390"></a>00390         sym_count_(0),
<a name="l00391"></a>00391         mpr_count_(0),
<a name="l00392"></a>00392         mprsel_empty_(true)
<a name="l00393"></a>00393     {}
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="a00013.html#39b47420bbf96804bd15a0a2041e16c3">00395</a>     <a class="code" href="a00013.html#39b47420bbf96804bd15a0a2041e16c3">CoherenceProxy::~CoherenceProxy</a>() {
<a name="l00396"></a>00396       <span class="keywordflow">while</span> (!<a class="code" href="a00013.html#16d0713380f372a4211e0c88c3f4a9bc">lset_</a>.empty())
<a name="l00397"></a>00397         <a class="code" href="a00013.html#1b8ee0360f50ac3dd0df8cc924be058e">erase</a>(<a class="code" href="a00013.html#16d0713380f372a4211e0c88c3f4a9bc">lset_</a>.begin());
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="preprocessor"># ifdef QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>    std::pair&lt;CoherenceProxy::neighborset_t::iterator, bool&gt;
<a name="l00402"></a>00402     <a class="code" href="a00013.html#4241453976bdd9942a7922a9fa56b532">CoherenceProxy::insert_link</a>(<span class="keyword">const</span> <a class="code" href="a00079.html">msg::Message::header</a>&amp; mh,
<a name="l00403"></a>00403                                 <span class="keyword">const</span> <span class="keywordtype">int</span> linktype,
<a name="l00404"></a>00404                                 <span class="keyword">const</span> <span class="keywordtype">int</span> will,
<a name="l00405"></a>00405                                 <span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp; htime) {
<a name="l00406"></a>00406       <span class="comment">// Insertion/search of the link and neighbor.</span>
<a name="l00407"></a>00407 
<a name="l00408"></a>00408       std::pair&lt;lset_t::iterator, bool&gt; lp =
<a name="l00409"></a>00409         <a class="code" href="a00013.html#16d0713380f372a4211e0c88c3f4a9bc">lset_</a>.insert(<a class="code" href="a00070.html">Link</a>(mh.<a class="code" href="a00079.html#1327a284e80cd6df0e00f2619392ff7b">receiver</a>, mh.<a class="code" href="a00079.html#d2b4cf39e611ce7ae91eec5e7d22204d">sender</a>,
<a name="l00410"></a>00410                           mh.<a class="code" href="a00079.html#fe482669ad7880eadf2f00f8c9c4d080">originator</a>, mh.<a class="code" href="a00079.html#621f952bee19ce9f3bd0388efdf137e5">validity</a>,
<a name="l00411"></a>00411                           mh.<a class="code" href="a00079.html#832461e640b4194fd1ddb0641146256b">pseqnum</a>, htime));
<a name="l00412"></a>00412 <span class="preprocessor"># else // !QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span>    std::pair&lt;CoherenceProxy::neighborset_t::iterator, bool&gt;
<a name="l00414"></a><a class="code" href="a00013.html#4241453976bdd9942a7922a9fa56b532">00414</a>     <a class="code" href="a00013.html#4241453976bdd9942a7922a9fa56b532">CoherenceProxy::insert_link</a>(<span class="keyword">const</span> <a class="code" href="a00079.html">msg::Message::header</a>&amp; mh,
<a name="l00415"></a>00415                                 <span class="keyword">const</span> <span class="keywordtype">int</span> linktype,
<a name="l00416"></a>00416                                 <span class="keyword">const</span> <span class="keywordtype">int</span> will) {
<a name="l00417"></a>00417       <span class="comment">// Insertion/search of the link and neighbor.</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419       std::pair&lt;lset_t::iterator, bool&gt; lp =
<a name="l00420"></a>00420         <a class="code" href="a00013.html#16d0713380f372a4211e0c88c3f4a9bc">lset_</a>.insert(<a class="code" href="a00070.html">Link</a>(mh.<a class="code" href="a00079.html#1327a284e80cd6df0e00f2619392ff7b">receiver</a>, mh.<a class="code" href="a00079.html#d2b4cf39e611ce7ae91eec5e7d22204d">sender</a>,
<a name="l00421"></a>00421                           mh.<a class="code" href="a00079.html#fe482669ad7880eadf2f00f8c9c4d080">originator</a>, mh.<a class="code" href="a00079.html#621f952bee19ce9f3bd0388efdf137e5">validity</a>));
<a name="l00422"></a>00422 <span class="preprocessor"># endif</span>
<a name="l00423"></a>00423 <span class="preprocessor"></span>      std::pair&lt;nset_t::iterator, bool&gt; np =
<a name="l00424"></a>00424         <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.insert(<a class="code" href="a00093.html">Neighbor</a>(mh.<a class="code" href="a00079.html#fe482669ad7880eadf2f00f8c9c4d080">originator</a>, lp.first, will));
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       <a class="code" href="a00070.html">Link</a>&amp;     l = <span class="keyword">const_cast&lt;</span><a class="code" href="a00070.html">Link</a>&amp;<span class="keyword">&gt;</span>(<span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00070.html">Link</a>&amp;<span class="keyword">&gt;</span>(*lp.first));
<a name="l00427"></a>00427 
<a name="l00428"></a>00428       <span class="comment">// If the previous operation appears to have been an</span>
<a name="l00429"></a>00429       <span class="comment">// insertion, insert the new neighbor into idx0_nset and</span>
<a name="l00430"></a>00430       <span class="comment">// idx1_nset (the sets on which HELLO::dump() and TC::dump()</span>
<a name="l00431"></a>00431       <span class="comment">// will actually iterate.</span>
<a name="l00432"></a>00432       <span class="comment">// Otherwise, update validity and insert the link into the</span>
<a name="l00433"></a>00433       <span class="comment">// "already known" neighbor.</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435       <span class="keywordflow">if</span> (lp.second) { <span class="comment">// link is new</span>
<a name="l00436"></a>00436         <a class="code" href="a00013.html#e60288d305ff99455b3787a6f496cb85">idx_lset_</a>.<a class="code" href="a00087.html#a3eb7eb3358e5fb814e37808d40d4fb8">insert</a>(lp.first);
<a name="l00437"></a>00437         <span class="keywordflow">if</span> (np.second) { <span class="comment">// neighbor is new</span>
<a name="l00438"></a>00438           <a class="code" href="a00013.html#3f616f4dc29fd6cec11f3fd2921615a9">idx_nset_</a>.<a class="code" href="a00087.html#a3eb7eb3358e5fb814e37808d40d4fb8">insert</a>(np.first);
<a name="l00439"></a>00439         } <span class="keywordflow">else</span>
<a name="l00440"></a>00440           <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*np.first).insert(lp.first);
<a name="l00441"></a>00441       } <span class="keywordflow">else</span> { <span class="comment">// link is not new</span>
<a name="l00442"></a>00442 <span class="preprocessor"># ifdef QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span>        l.set_htime(htime);
<a name="l00444"></a>00444 <span class="preprocessor"># endif // !QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00445"></a>00445 <span class="preprocessor"></span>      }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="preprocessor"># ifdef QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>      l.set_nexttime(<a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(htime * <a class="code" href="a00292.html#2f9a6c5cf6c5a6d55d01af68546d82c7">cst::hello_grace</a>));
<a name="l00449"></a>00449 <span class="preprocessor"># endif // !QOLYESTER_ENABLE_LINKHYS</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>
<a name="l00451"></a>00451       <span class="keywordflow">if</span> (!np.second)
<a name="l00452"></a>00452         <a class="code" href="a00013.html#5df44ecbda95b9d139237c959962be35">set_willingness</a>(np.first, will);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454       <span class="comment">// Update L_ASYM_time</span>
<a name="l00455"></a>00455       l.<a class="code" href="a00070.html#cbf81e20b326762ccb4b9e45763b6881">set_asymtime</a>(<a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(mh.<a class="code" href="a00079.html#621f952bee19ce9f3bd0388efdf137e5">validity</a>));
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="comment">// Update L_SYM_time and L_time</span>
<a name="l00458"></a>00458       <span class="keywordflow">switch</span> (linktype) {
<a name="l00459"></a>00459       <span class="keywordflow">case</span> <a class="code" href="a00192.html#9b5991e4018faf19948413a679e5b85f">LOST_LINK</a>:
<a name="l00460"></a>00460         l.<a class="code" href="a00070.html#2e61d6ad3e13c52a159454474ebe3fec">set_symtime</a>(<a class="code" href="a00170.html#3cec049068a76d398d51c7a7e871f456">timeval_t::now</a>() - 1000); <span class="comment">// expired</span>
<a name="l00461"></a>00461         <span class="keywordflow">break</span>;
<a name="l00462"></a>00462       <span class="keywordflow">case</span> <a class="code" href="a00192.html#4748e5ed515aeffd63d7a18bc878ded4">SYM_LINK</a>:
<a name="l00463"></a>00463       <span class="keywordflow">case</span> <a class="code" href="a00192.html#08190577fb83615126a81b68f96a10fd">ASYM_LINK</a>:
<a name="l00464"></a>00464         l.<a class="code" href="a00070.html#2e61d6ad3e13c52a159454474ebe3fec">set_symtime</a>(<a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(mh.<a class="code" href="a00079.html#621f952bee19ce9f3bd0388efdf137e5">validity</a>));
<a name="l00465"></a>00465         l.<a class="code" href="a00070.html#ba7786bfd3bfe3dbc5bcd0bbc575b10e">set_time</a>(lp.first-&gt;symtime() + <a class="code" href="a00292.html#0608ffabb7d5aa9554f920f8af7758e7">cst::neighb_hold_time</a>);
<a name="l00466"></a>00466         <span class="keywordflow">break</span>;
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469       <span class="keywordflow">if</span> (l.<a class="code" href="a00070.html#c130db66ab31f6302f3e07f6155b1889">time</a>() &lt; l.<a class="code" href="a00070.html#26e471eb40baa5aaa9342ae3ac4c1dfd">asymtime</a>())
<a name="l00470"></a>00470         l.<a class="code" href="a00070.html#ba7786bfd3bfe3dbc5bcd0bbc575b10e">set_time</a>(l.<a class="code" href="a00070.html#26e471eb40baa5aaa9342ae3ac4c1dfd">asymtime</a>());
<a name="l00471"></a>00471 
<a name="l00472"></a>00472       <span class="keyword">typedef</span> <a class="code" href="a00071.html">upd::LinkUpdater</a>  lu_t;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*  e = lp.first-&gt;updater();
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <span class="keywordflow">if</span> (e == 0) {
<a name="l00477"></a>00477         e = <span class="keyword">new</span> <a class="code" href="a00013.html#9e348de8a6e96604c45404b6ed5a0a33">link_updater_t</a>(lu_t::min_time(l),
<a name="l00478"></a>00478                                lu_t(*<span class="keyword">this</span>, lp.first));
<a name="l00479"></a>00479         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">ulink_t</a>&amp;<span class="keyword">&gt;</span>(*lp.first).set_updater(e);
<a name="l00480"></a>00480       } <span class="keywordflow">else</span> {
<a name="l00481"></a>00481         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#f41e7209a003243d0e0b15acc7ccf4d4">erase</a>(e);
<a name="l00482"></a>00482         e-&gt;<a class="code" href="a00168.html#3188e11b0e793a3c11b2018a25263942">set_next</a>(lu_t::min_time(l));
<a name="l00483"></a>00483       }
<a name="l00484"></a>00484       <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#98a2a5559ea1adb7bce7cc0e0609db5c">insert</a>(e);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486       <a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(np.first);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488       <span class="keyword">typedef</span> std::pair&lt;neighborset_t::iterator, bool&gt;  ret_t;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490       <span class="comment">// neighborset_t is a MaskIterator, but we don't call check()</span>
<a name="l00491"></a>00491       <span class="comment">// on return, because we assume it would never erase the</span>
<a name="l00492"></a>00492       <span class="comment">// freshly created/update element.</span>
<a name="l00493"></a>00493       <span class="keywordflow">return</span> ret_t(<a class="code" href="a00023.html">neighborset_t::iterator</a>::
<a name="l00494"></a>00494                    build(<a class="code" href="a00075.html">neighborset_t::mask_iterator</a>(np.first, <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>, *<span class="keyword">this</span>)),
<a name="l00495"></a>00495                    np.second);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="keywordtype">void</span>
<a name="l00500"></a><a class="code" href="a00013.html#5df44ecbda95b9d139237c959962be35">00500</a>     <a class="code" href="a00013.html#5df44ecbda95b9d139237c959962be35">CoherenceProxy::set_willingness</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos,
<a name="l00501"></a>00501                                     <span class="keywordtype">unsigned</span> w) {
<a name="l00502"></a>00502       <span class="keywordflow">if</span> (pos-&gt;willingness() != w) {
<a name="l00503"></a>00503         <a class="code" href="a00289.html#93d438a99840d6124c2e415f4bc3c2a3">mprset_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00504"></a>00504         <a class="code" href="a00289.html#725e72b5f17434a9e7f942190f9289d3">routes_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00505"></a>00505         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_willingness(w);
<a name="l00506"></a>00506         <a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">update_graph</a>(pos);
<a name="l00507"></a>00507       }
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <span class="keywordtype">void</span>
<a name="l00511"></a><a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">00511</a>     <a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">CoherenceProxy::update_graph</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00512"></a>00512       <span class="keywordtype">unsigned</span>  w = pos-&gt;willingness();
<a name="l00513"></a>00513       <span class="keywordflow">if</span> (pos-&gt;is_sym()) {
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <span class="comment">// A node's weight is used by the Dijkstra algorithm to prefer</span>
<a name="l00516"></a>00516         <span class="comment">// nodes with larger weight, in case of ties.  If the weight</span>
<a name="l00517"></a>00517         <span class="comment">// is 0, then the relaxation is not performed at all, this is</span>
<a name="l00518"></a>00518         <span class="comment">// used to forbid routing through nodes with willingness of</span>
<a name="l00519"></a>00519         <span class="comment">// WILL_NEVER.  Those nodes have to be in path_net anyway,</span>
<a name="l00520"></a>00520         <span class="comment">// just in case the willingness changes and all the 2-hop</span>
<a name="l00521"></a>00521         <span class="comment">// neighbors going through it must be reachable again.</span>
<a name="l00522"></a>00522 
<a name="l00523"></a>00523         <span class="keywordtype">unsigned</span> new_weight =
<a name="l00524"></a>00524           w != 0 ?
<a name="l00525"></a>00525           w + (pos-&gt;is_mprsel() ? <a class="code" href="a00192.html#fc02d812392bc2a60c4334db3d19cbd4">WILL_DEFAULT</a> : 0) :
<a name="l00526"></a>00526           0;
<a name="l00527"></a>00527         std::pair&lt;gra::AdjGraph::nset_t::const_iterator, bool&gt;  p =
<a name="l00528"></a>00528           <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#a5443506c3816c350c36d84e5c1b640b">insert_node</a>(<a class="code" href="a00004.html" title="A Node of the graph.">gra::AdjNode</a>(pos-&gt;main_addr(), new_weight));
<a name="l00529"></a>00529         <span class="keywordflow">if</span> (!p.second)
<a name="l00530"></a>00530           <span class="keyword">const_cast&lt;</span><a class="code" href="a00004.html" title="A Node of the graph.">gra::AdjNode</a>&amp;<span class="keyword">&gt;</span>(*p.first).set_weight(new_weight);
<a name="l00531"></a>00531       } <span class="keywordflow">else</span> {
<a name="l00532"></a>00532         <a class="code" href="a00152.html#70e3d7d682697841fd03c0dcaf901504">gra::AdjGraph::nset_t::iterator</a> x =
<a name="l00533"></a>00533           gra::AdjGraph::nset_t::iterator::
<a name="l00534"></a>00534           build(<a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#f063c4fe62944d60446b8e14591f9157">nodes</a>().find(<a class="code" href="a00004.html" title="A Node of the graph.">gra::AdjNode</a>::
<a name="l00535"></a>00535                                       make_key(pos-&gt;main_addr())));
<a name="l00536"></a>00536         <span class="keywordflow">if</span> (x != <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#f063c4fe62944d60446b8e14591f9157">nodes</a>().end()) {
<a name="l00537"></a>00537           <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#c02755f32025197620270dadbd0808db">remove_node_if_alone</a>(x);
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539       }
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keywordtype">bool</span>
<a name="l00543"></a><a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">00543</a>     <a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">CoherenceProxy::update_state</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00544"></a>00544       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00545"></a>00545       <span class="keywordtype">bool</span>      sym = <span class="keyword">false</span>;
<a name="l00546"></a>00546       <span class="keywordtype">bool</span>      valid = <span class="keyword">false</span>;
<a name="l00547"></a>00547       <span class="comment">// The following loop has to be executed entirely without</span>
<a name="l00548"></a>00548       <span class="comment">// breaking out as soon as a symmetric link is found (cleanup).</span>
<a name="l00549"></a>00549       <span class="keywordflow">for</span> (<a class="code" href="a00023.html">Neighbor::linkset_t::iterator</a> i =
<a name="l00550"></a>00550              const_cast&lt;uneighbor_t&amp;&gt;(*pos).linkset().begin();
<a name="l00551"></a>00551            i != <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).linkset().end(); ++i) {
<a name="l00552"></a>00552         <span class="keywordtype">bool</span>    link_sym = i-&gt;is_sym();
<a name="l00553"></a>00553         valid = <span class="keyword">true</span>;
<a name="l00554"></a>00554         <span class="keywordflow">if</span> (link_sym != i-&gt;was_sym()) {
<a name="l00555"></a>00555           <a class="code" href="a00289.html#725e72b5f17434a9e7f942190f9289d3">routes_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00556"></a>00556           i-&gt;set_was_sym(link_sym);
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558         <span class="keywordflow">if</span> (link_sym &amp;&amp; !sym)
<a name="l00559"></a>00559           sym = <span class="keyword">true</span>;
<a name="l00560"></a>00560       }
<a name="l00561"></a>00561       <span class="keywordflow">if</span> (sym) {
<a name="l00562"></a>00562         <a class="code" href="a00013.html#fc9f645f81751b155a901990bdfbd797">set_sym</a>(pos);
<a name="l00563"></a>00563       } <span class="keywordflow">else</span> {
<a name="l00564"></a>00564         <a class="code" href="a00013.html#cc8fa2e53fabdeaf7ab3318bc05a6aab">unset_sym</a>(pos);
<a name="l00565"></a>00565       }
<a name="l00566"></a>00566       <span class="comment">// Don't touch the graph here as it's taken care of in</span>
<a name="l00567"></a>00567       <span class="comment">// {,un}set_{sym,mpr,mprsel} methods.</span>
<a name="l00568"></a>00568       <span class="keywordflow">return</span> valid;
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="keywordtype">void</span>
<a name="l00572"></a><a class="code" href="a00013.html#ede669b632f36e2f5c85b2a234f47c96">00572</a>     <a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">CoherenceProxy::update_state</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; maddr) {
<a name="l00573"></a>00573       nset_t::iterator  x = <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.find(<a class="code" href="a00093.html#583ed09ee37bafb0a24c0e0570a53bc9">Neighbor::make_key</a>(maddr));
<a name="l00574"></a>00574       <span class="keywordflow">if</span> (x != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end())
<a name="l00575"></a>00575         <a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(x);
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordtype">void</span>
<a name="l00579"></a><a class="code" href="a00013.html#fc9f645f81751b155a901990bdfbd797">00579</a>     <a class="code" href="a00013.html#fc9f645f81751b155a901990bdfbd797">CoherenceProxy::set_sym</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00580"></a>00580       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (!pos-&gt;is_sym()) {
<a name="l00582"></a>00582         ++<a class="code" href="a00013.html#620855cb0a32c56f9b132a7d9d566776">sym_count_</a>;
<a name="l00583"></a>00583         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_sym(<span class="keyword">true</span>);
<a name="l00584"></a>00584         <a class="code" href="a00289.html#93d438a99840d6124c2e415f4bc3c2a3">mprset_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00585"></a>00585         <a class="code" href="a00289.html#725e72b5f17434a9e7f942190f9289d3">routes_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00586"></a>00586         <a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">update_graph</a>(pos);
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (<a class="code" href="a00289.html#e276047310e2ef9ca79158bb104e4767">tc_redundancy</a> == wholeset) {
<a name="l00588"></a>00588           <a class="code" href="a00013.html#ac28214c29ad6360aff0e5b81904ad72">advset_changed_</a> = <span class="keyword">true</span>;
<a name="l00589"></a>00589           <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591       }
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="keywordtype">void</span>
<a name="l00595"></a><a class="code" href="a00013.html#cc8fa2e53fabdeaf7ab3318bc05a6aab">00595</a>     <a class="code" href="a00013.html#cc8fa2e53fabdeaf7ab3318bc05a6aab">CoherenceProxy::unset_sym</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00596"></a>00596       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00597"></a>00597       <span class="keywordflow">if</span> (pos-&gt;is_sym()) {
<a name="l00598"></a>00598         <a class="code" href="a00013.html#bbd77e650b6d895265251139eb56f617">unset_mpr</a>(pos);
<a name="l00599"></a>00599         <a class="code" href="a00013.html#597f13bc32f98e0231df67cfcb8a9fd5">unset_mprsel</a>(pos);
<a name="l00600"></a>00600         --<a class="code" href="a00013.html#620855cb0a32c56f9b132a7d9d566776">sym_count_</a>;
<a name="l00601"></a>00601         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_sym(<span class="keyword">false</span>);
<a name="l00602"></a>00602         <a class="code" href="a00289.html#93d438a99840d6124c2e415f4bc3c2a3">mprset_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00603"></a>00603         <a class="code" href="a00289.html#725e72b5f17434a9e7f942190f9289d3">routes_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00604"></a>00604         <a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">update_graph</a>(pos);
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (<a class="code" href="a00289.html#e276047310e2ef9ca79158bb104e4767">tc_redundancy</a> == wholeset) {
<a name="l00606"></a>00606           <a class="code" href="a00013.html#ac28214c29ad6360aff0e5b81904ad72">advset_changed_</a> = <span class="keyword">true</span>;
<a name="l00607"></a>00607           <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609       }
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="keywordtype">void</span>
<a name="l00613"></a><a class="code" href="a00013.html#959c30709862570e18877f54abf5d9cd">00613</a>     <a class="code" href="a00013.html#959c30709862570e18877f54abf5d9cd">CoherenceProxy::set_mpr</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00614"></a>00614       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00615"></a>00615       assert(pos-&gt;is_sym());
<a name="l00616"></a>00616       <span class="keywordflow">if</span> (!pos-&gt;is_mpr()) {
<a name="l00617"></a>00617         ++<a class="code" href="a00013.html#06130e426de4712204ff35c8e601fe63">mpr_count_</a>;
<a name="l00618"></a>00618         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_mpr(<span class="keyword">true</span>);
<a name="l00619"></a>00619         <a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">update_graph</a>(pos);
<a name="l00620"></a>00620         <span class="keywordflow">if</span> (<a class="code" href="a00289.html#e276047310e2ef9ca79158bb104e4767">tc_redundancy</a> &gt;= mprselset_mprset) {
<a name="l00621"></a>00621           <a class="code" href="a00013.html#ac28214c29ad6360aff0e5b81904ad72">advset_changed_</a> = <span class="keyword">true</span>;
<a name="l00622"></a>00622           <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624       }
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627     <span class="keywordtype">void</span>
<a name="l00628"></a><a class="code" href="a00013.html#b32747f8a72347b3ec8a3d4d170ec6f9">00628</a>     <a class="code" href="a00013.html#959c30709862570e18877f54abf5d9cd">CoherenceProxy::set_mpr</a>(<span class="keyword">const</span> <a class="code" href="a00023.html">sym_neighborset_t::iterator</a>&amp; pos) {
<a name="l00629"></a>00629       <a class="code" href="a00013.html#959c30709862570e18877f54abf5d9cd">set_mpr</a>(pos.mask_super().mask_super());
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632     <span class="keywordtype">void</span>
<a name="l00633"></a><a class="code" href="a00013.html#bbd77e650b6d895265251139eb56f617">00633</a>     <a class="code" href="a00013.html#bbd77e650b6d895265251139eb56f617">CoherenceProxy::unset_mpr</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00634"></a>00634       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00635"></a>00635       assert(pos-&gt;is_sym());
<a name="l00636"></a>00636       <span class="keywordflow">if</span> (pos-&gt;is_mpr()) {
<a name="l00637"></a>00637         --<a class="code" href="a00013.html#06130e426de4712204ff35c8e601fe63">mpr_count_</a>;
<a name="l00638"></a>00638         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_mpr(<span class="keyword">false</span>);
<a name="l00639"></a>00639         <a class="code" href="a00013.html#742613c77648dae07af6ce884fe1aec3">update_graph</a>(pos);
<a name="l00640"></a>00640         <span class="keywordflow">if</span> (<a class="code" href="a00289.html#e276047310e2ef9ca79158bb104e4767">tc_redundancy</a> &gt;= mprselset_mprset) {
<a name="l00641"></a>00641           <a class="code" href="a00013.html#ac28214c29ad6360aff0e5b81904ad72">advset_changed_</a> = <span class="keyword">true</span>;
<a name="l00642"></a>00642           <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00643"></a>00643         }
<a name="l00644"></a>00644       }
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     <span class="keywordtype">void</span>
<a name="l00648"></a><a class="code" href="a00013.html#f3e2ce467815b3de4b3fc4ca84bf0e93">00648</a>     <a class="code" href="a00013.html#bbd77e650b6d895265251139eb56f617">CoherenceProxy::unset_mpr</a>(<span class="keyword">const</span> <a class="code" href="a00023.html">sym_neighborset_t::iterator</a>&amp; pos) {
<a name="l00649"></a>00649       <a class="code" href="a00013.html#bbd77e650b6d895265251139eb56f617">unset_mpr</a>(pos.mask_super().mask_super());
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="keywordtype">void</span>
<a name="l00653"></a><a class="code" href="a00013.html#c8bc7990d5eb0762e8461ef87f193560">00653</a>     <a class="code" href="a00013.html#c8bc7990d5eb0762e8461ef87f193560">CoherenceProxy::set_mprsel</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos,
<a name="l00654"></a>00654                                <span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp; v) {
<a name="l00655"></a>00655       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00656"></a>00656       <span class="comment">// This used to be an assertion, but ought to be a check.</span>
<a name="l00657"></a>00657       <span class="keywordflow">if</span> (!pos-&gt;is_sym())
<a name="l00658"></a>00658         <span class="keywordflow">return</span>;
<a name="l00659"></a>00659       assert(<a class="code" href="a00289.html#74c37391ca356ed52ae5b0260f295f1a">timeval_t</a>(0) &lt; v);
<a name="l00660"></a>00660       <span class="keywordflow">if</span> (!pos-&gt;is_mprsel()) {
<a name="l00661"></a>00661         <a class="code" href="a00013.html#40ac31a3ca30ffc2ed6cb6a669b2b794">mprsel_empty_</a> = <span class="keyword">false</span>;
<a name="l00662"></a>00662         <a class="code" href="a00013.html#ac28214c29ad6360aff0e5b81904ad72">advset_changed_</a> = <span class="keyword">true</span>;
<a name="l00663"></a>00663         <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00664"></a>00664       }
<a name="l00665"></a>00665       <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_mprsel(v);
<a name="l00666"></a>00666       <span class="keyword">typedef</span> <a class="code" href="a00096.html">upd::NeighborUpdater</a>      nu_t;
<a name="l00667"></a>00667       <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*  e = pos-&gt;updater();
<a name="l00668"></a>00668       <span class="keywordflow">if</span> (e == 0) {
<a name="l00669"></a>00669         e = <span class="keyword">new</span> <a class="code" href="a00013.html#ff796a7d190642b9a780f82902cc80d0">neighbor_updater_t</a>(<a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(v), nu_t(*<span class="keyword">this</span>, pos));
<a name="l00670"></a>00670         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_updater(e);
<a name="l00671"></a>00671       } <span class="keywordflow">else</span> {
<a name="l00672"></a>00672         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#f41e7209a003243d0e0b15acc7ccf4d4">erase</a>(e);
<a name="l00673"></a>00673         e-&gt;<a class="code" href="a00168.html#3188e11b0e793a3c11b2018a25263942">set_next</a>(<a class="code" href="a00170.html#a63a6fe221b20b08a4976b5a665dc653">timeval_t::in</a>(v));
<a name="l00674"></a>00674       }
<a name="l00675"></a>00675       <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#98a2a5559ea1adb7bce7cc0e0609db5c">insert</a>(e);
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678     <span class="keywordtype">void</span>
<a name="l00679"></a><a class="code" href="a00013.html#597f13bc32f98e0231df67cfcb8a9fd5">00679</a>     <a class="code" href="a00013.html#597f13bc32f98e0231df67cfcb8a9fd5">CoherenceProxy::unset_mprsel</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00680"></a>00680       assert(pos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end());
<a name="l00681"></a>00681       <span class="comment">//assert(pos-&gt;is_sym());</span>
<a name="l00682"></a>00682       <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*  e = pos-&gt;updater();
<a name="l00683"></a>00683       <span class="keywordflow">if</span> (pos-&gt;is_mprsel()) {
<a name="l00684"></a>00684         assert(e != 0);
<a name="l00685"></a>00685         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#108ff93e31982cfbddf7e3d4f3e2b352">destroy</a>(e);
<a name="l00686"></a>00686         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_updater(0);
<a name="l00687"></a>00687         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).unset_mprsel();
<a name="l00688"></a>00688       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e != 0) {
<a name="l00689"></a>00689         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#108ff93e31982cfbddf7e3d4f3e2b352">destroy</a>(e);
<a name="l00690"></a>00690         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*pos).set_updater(0);
<a name="l00691"></a>00691       }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693       <span class="keywordflow">if</span> (const_cast&lt;uneighbor_t&amp;&gt;(*pos).was_mprsel()) {
<a name="l00694"></a>00694         <a class="code" href="a00013.html#ac28214c29ad6360aff0e5b81904ad72">advset_changed_</a> = <span class="keyword">true</span>;
<a name="l00695"></a>00695         <a class="code" href="a00289.html#953481c01922d01859478ba8f818b896">advset_changed</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00696"></a>00696       }
<a name="l00697"></a>00697 <span class="comment">//       if (pos-&gt;is_used()) {</span>
<a name="l00698"></a>00698 <span class="comment">// //   const NeighborUpdater&amp;  nu = *pos-&gt;del_pos();</span>
<a name="l00699"></a>00699 <span class="comment">// //   del_set.erase(pos-&gt;del_pos());</span>
<a name="l00700"></a>00700 <span class="comment">// //   delete &amp;nu;</span>
<a name="l00701"></a>00701 <span class="comment">// //   del_set.shift();</span>
<a name="l00702"></a>00702 <span class="comment">//      const_cast&lt;nelem_&amp;&gt;(*pos).unuse();</span>
<a name="l00703"></a>00703 <span class="comment">//       }</span>
<a name="l00704"></a>00704     }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     <span class="keywordtype">bool</span>
<a name="l00707"></a><a class="code" href="a00013.html#10af938d64c7b2fcf053a33d157c27af">00707</a>     <a class="code" href="a00013.html#10af938d64c7b2fcf053a33d157c27af">CoherenceProxy::is_advset_empty</a>() {
<a name="l00708"></a>00708       <span class="keywordflow">if</span> (<a class="code" href="a00013.html#40ac31a3ca30ffc2ed6cb6a669b2b794">mprsel_empty_</a>)
<a name="l00709"></a>00709         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00710"></a>00710       <a class="code" href="a00013.html#40ac31a3ca30ffc2ed6cb6a669b2b794">mprsel_empty_</a> = <span class="keyword">true</span>;
<a name="l00711"></a>00711       <span class="keywordflow">for</span> (<a class="code" href="a00023.html">sym_neighborset_t::iterator</a> i = <a class="code" href="a00013.html#ab83019e9105c758272214f710b65ddb">sym_neighborset_</a>.<a class="code" href="a00162.html#1477b141cda62051d2fe192bd35a00ed">begin</a>();
<a name="l00712"></a>00712            i != <a class="code" href="a00013.html#ab83019e9105c758272214f710b65ddb">sym_neighborset_</a>.<a class="code" href="a00162.html#2b6b14e5fad245ff0480c0c2b0cce847">end</a>(); ++i)
<a name="l00713"></a>00713         <span class="keywordflow">if</span> (i-&gt;is_mprsel()) {
<a name="l00714"></a>00714           <a class="code" href="a00013.html#40ac31a3ca30ffc2ed6cb6a669b2b794">mprsel_empty_</a> = <span class="keyword">false</span>;
<a name="l00715"></a>00715           <span class="keywordflow">break</span>;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717       <span class="keywordflow">return</span> <a class="code" href="a00013.html#40ac31a3ca30ffc2ed6cb6a669b2b794">mprsel_empty_</a>;
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <span class="keywordtype">bool</span>
<a name="l00721"></a><a class="code" href="a00013.html#e10961a6de8457287bda79a5df94f1cc">00721</a>     <a class="code" href="a00013.html#e10961a6de8457287bda79a5df94f1cc">CoherenceProxy::is_valid</a>(<span class="keyword">const</span> nset_t::iterator&amp; pos) {
<a name="l00722"></a>00722       <span class="keywordflow">return</span> <a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(pos);
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     <span class="keywordtype">bool</span>
<a name="l00726"></a><a class="code" href="a00013.html#a2af073850a065eb9490ae60404d5d6c">00726</a>     <a class="code" href="a00013.html#e10961a6de8457287bda79a5df94f1cc">CoherenceProxy::is_valid</a>(<span class="keyword">const</span> <a class="code" href="a00067.html">idx_nset_t::iterator</a>&amp; pos) {
<a name="l00727"></a>00727       <span class="keywordflow">return</span> <a class="code" href="a00013.html#7415e01b24bdaec93c0845c84f41e548">update_state</a>(*pos.deref_super());
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="keywordtype">void</span>
<a name="l00731"></a><a class="code" href="a00013.html#1b8ee0360f50ac3dd0df8cc924be058e">00731</a>     <a class="code" href="a00013.html#1b8ee0360f50ac3dd0df8cc924be058e">CoherenceProxy::erase</a>(lset_t::iterator pos) {
<a name="l00732"></a>00732       nset_t::iterator  npos =
<a name="l00733"></a>00733         <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.find(<a class="code" href="a00093.html#583ed09ee37bafb0a24c0e0570a53bc9">Neighbor::make_key</a>(pos-&gt;main_addr()));
<a name="l00734"></a>00734       <span class="keywordflow">if</span> (npos != <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.end()) {
<a name="l00735"></a>00735         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">uneighbor_t</a>&amp;<span class="keyword">&gt;</span>(*npos).erase(pos);
<a name="l00736"></a>00736         <span class="keywordflow">if</span> (!<a class="code" href="a00013.html#e10961a6de8457287bda79a5df94f1cc">is_valid</a>(npos))
<a name="l00737"></a>00737           <a class="code" href="a00013.html#fceb3cc6248cab79474d6ef7c6e0fac7">erase_from_all</a>(npos);
<a name="l00738"></a>00738       }
<a name="l00739"></a>00739 <span class="comment">//       const LinkUpdater&amp;     lu = *pos-&gt;del_pos();</span>
<a name="l00740"></a>00740 <span class="comment">//       del_set.erase(pos-&gt;del_pos());</span>
<a name="l00741"></a>00741 <span class="comment">//       delete &amp;lu;</span>
<a name="l00742"></a>00742       <a class="code" href="a00013.html#e60288d305ff99455b3787a6f496cb85">idx_lset_</a>.<a class="code" href="a00087.html#7704dd06ac05caec1eb7cbd04daf311e">erase</a>(pos);
<a name="l00743"></a>00743       <a class="code" href="a00013.html#16d0713380f372a4211e0c88c3f4a9bc">lset_</a>.erase(pos);
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <span class="keywordtype">void</span>
<a name="l00747"></a><a class="code" href="a00013.html#fceb3cc6248cab79474d6ef7c6e0fac7">00747</a>     <a class="code" href="a00013.html#fceb3cc6248cab79474d6ef7c6e0fac7">CoherenceProxy::erase_from_all</a>(nset_t::iterator pos) {
<a name="l00748"></a>00748       <span class="comment">// First call CoherenceProxy::unset_sym() to update counters</span>
<a name="l00749"></a>00749       <span class="comment">// and remove the node from the graph.</span>
<a name="l00750"></a>00750       <a class="code" href="a00013.html#cc8fa2e53fabdeaf7ab3318bc05a6aab">unset_sym</a>(pos);
<a name="l00751"></a>00751       <span class="comment">// Second remove the neighbor from the indices.</span>
<a name="l00752"></a>00752       <a class="code" href="a00013.html#3f616f4dc29fd6cec11f3fd2921615a9">idx_nset_</a>.<a class="code" href="a00087.html#7704dd06ac05caec1eb7cbd04daf311e">erase</a>(pos);
<a name="l00753"></a>00753       <span class="comment">// Third remove the node /per se/.</span>
<a name="l00754"></a>00754       <a class="code" href="a00013.html#787a99d6ea2df5bd37b542363c90aa7e">nset_</a>.erase(pos);
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757     <span class="keywordtype">void</span>
<a name="l00758"></a><a class="code" href="a00013.html#08857b7068fbd99367f2589642b4a4a3">00758</a>     <a class="code" href="a00013.html#08857b7068fbd99367f2589642b4a4a3">CoherenceProxy::add_interface</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; a) {
<a name="l00759"></a>00759       <a class="code" href="a00013.html#e60288d305ff99455b3787a6f496cb85">idx_lset_</a>.<a class="code" href="a00087.html#558f9f6313e73ef5e7c0f2840a981d6f">add_key</a>(a);
<a name="l00760"></a>00760       <a class="code" href="a00013.html#3f616f4dc29fd6cec11f3fd2921615a9">idx_nset_</a>.<a class="code" href="a00087.html#558f9f6313e73ef5e7c0f2840a981d6f">add_key</a>(a);
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <span class="keywordtype">void</span>
<a name="l00764"></a><a class="code" href="a00013.html#cb45c07e3d9b48419303f86451e799fa">00764</a>     <a class="code" href="a00013.html#cb45c07e3d9b48419303f86451e799fa">CoherenceProxy::remove_interface</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; a) {
<a name="l00765"></a>00765       <span class="keywordflow">for</span> (<a class="code" href="a00023.html">linkset_t::iterator</a> i = <a class="code" href="a00013.html#7ba395d051d85ee270053ecd5397e525">linkset_</a>.<a class="code" href="a00162.html#1477b141cda62051d2fe192bd35a00ed">begin</a>(); i != <a class="code" href="a00013.html#7ba395d051d85ee270053ecd5397e525">linkset_</a>.<a class="code" href="a00162.html#2b6b14e5fad245ff0480c0c2b0cce847">end</a>();
<a name="l00766"></a>00766            <span class="comment">/* ++i */</span>)
<a name="l00767"></a>00767         <span class="keywordflow">if</span> (i-&gt;local_addr() == a)
<a name="l00768"></a>00768           <a class="code" href="a00013.html#1b8ee0360f50ac3dd0df8cc924be058e">erase</a>(i++);
<a name="l00769"></a>00769         <span class="keywordflow">else</span>
<a name="l00770"></a>00770           ++i;
<a name="l00771"></a>00771       <a class="code" href="a00013.html#e60288d305ff99455b3787a6f496cb85">idx_lset_</a>.<a class="code" href="a00087.html#5b423f980f06a02e4e11a06cbe2878c0">remove_key</a>(a);
<a name="l00772"></a>00772       <a class="code" href="a00013.html#3f616f4dc29fd6cec11f3fd2921615a9">idx_nset_</a>.<a class="code" href="a00087.html#5b423f980f06a02e4e11a06cbe2878c0">remove_key</a>(a);
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">//********************************************</span>
<a name="l00777"></a>00777     <span class="comment">//* TwoHopNeighbor definition</span>
<a name="l00778"></a>00778     <span class="comment">//*</span>
<a name="l00779"></a>00779 
<a name="l00780"></a><a class="code" href="a00174.html#e14fb86bb092709b66a786487d132ea2">00780</a>     <a class="code" href="a00174.html#e14fb86bb092709b66a786487d132ea2">TwoHopNeighbor::TwoHopNeighbor</a>() :
<a name="l00781"></a>00781       mainaddr_(),
<a name="l00782"></a>00782       twohopaddr_(),
<a name="l00783"></a>00783       time_(0, 0)
<a name="l00784"></a>00784     {}
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="a00174.html#ffb628abfac358953a79e1e74c41e486">00786</a>     <a class="code" href="a00174.html#e14fb86bb092709b66a786487d132ea2">TwoHopNeighbor::TwoHopNeighbor</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; a,
<a name="l00787"></a>00787                                    <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; tha,
<a name="l00788"></a>00788                                    <span class="keyword">const</span> <a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>&amp;   validity) :
<a name="l00789"></a>00789       <a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a>(a),
<a name="l00790"></a>00790       <a class="code" href="a00174.html#f9fb08a6b488fa2fbdd20b0a78110523">twohopaddr_</a>(tha),
<a name="l00791"></a>00791       <a class="code" href="a00174.html#93dae4af8bbd8a2e8fa8941f18c5ae40">time_</a>(<a class="code" href="a00170.html" title="Proxy class for the timeval standard C data structure.">timeval_t</a>::in(validity))
<a name="l00792"></a>00792     {}
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     <span class="keywordtype">bool</span>
<a name="l00795"></a><a class="code" href="a00174.html#8e722c72b52f95c19e57875a291088f1">00795</a>     <a class="code" href="a00174.html#8e722c72b52f95c19e57875a291088f1">TwoHopNeighbor::operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="a00174.html">This</a>&amp; rhs)<span class="keyword"> const </span>{
<a name="l00796"></a>00796       <span class="keywordflow">if</span> (<a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a> == rhs.<a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a>)
<a name="l00797"></a>00797         <span class="keywordflow">return</span> <a class="code" href="a00174.html#f9fb08a6b488fa2fbdd20b0a78110523">twohopaddr_</a> &lt; rhs.<a class="code" href="a00174.html#f9fb08a6b488fa2fbdd20b0a78110523">twohopaddr_</a>;
<a name="l00798"></a>00798       <span class="keywordflow">return</span> <a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a> &lt; rhs.<a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a>;
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     <a class="code" href="a00174.html">TwoHopNeighbor</a>&amp;
<a name="l00802"></a><a class="code" href="a00174.html#b4971456b608823a8f74245dd6a1fb5b">00802</a>     <a class="code" href="a00174.html#b4971456b608823a8f74245dd6a1fb5b">TwoHopNeighbor::operator=</a>(<span class="keyword">const</span> <a class="code" href="a00174.html">This</a>&amp; other) {
<a name="l00803"></a>00803       assert(<a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a> == other.<a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a>);
<a name="l00804"></a>00804       assert(<a class="code" href="a00174.html#f9fb08a6b488fa2fbdd20b0a78110523">twohopaddr_</a> == other.<a class="code" href="a00174.html#f9fb08a6b488fa2fbdd20b0a78110523">twohopaddr_</a>);
<a name="l00805"></a>00805       <a class="code" href="a00174.html#93dae4af8bbd8a2e8fa8941f18c5ae40">time_</a> = other.<a class="code" href="a00174.html#93dae4af8bbd8a2e8fa8941f18c5ae40">time_</a>;
<a name="l00806"></a>00806       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="keyword">const</span> <a class="code" href="a00174.html">TwoHopNeighbor</a>&amp;
<a name="l00810"></a><a class="code" href="a00174.html#1597a6d25e1bc32a64bf77588ae8cdad">00810</a>     <a class="code" href="a00174.html#1597a6d25e1bc32a64bf77588ae8cdad">TwoHopNeighbor::make_key</a>(<span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; ma, <span class="keyword">const</span> <a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp; tha) {
<a name="l00811"></a>00811       <span class="keyword">const_cast&lt;</span><a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00174.html#2170518f761648e30d4b9dc8fb319c3d">dummy_for_find_</a>.<a class="code" href="a00174.html#d44e3569737a6d1c4f32fc49cf864026">mainaddr_</a>) = ma;
<a name="l00812"></a>00812       <span class="keyword">const_cast&lt;</span><a class="code" href="a00059.html" title="IPv6 address class.">address_t</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="a00174.html#2170518f761648e30d4b9dc8fb319c3d">dummy_for_find_</a>.<a class="code" href="a00174.html#f9fb08a6b488fa2fbdd20b0a78110523">twohopaddr_</a>) = tha;
<a name="l00813"></a>00813       <span class="keywordflow">return</span> <a class="code" href="a00174.html#2170518f761648e30d4b9dc8fb319c3d">dummy_for_find_</a>;
<a name="l00814"></a>00814     }
<a name="l00815"></a>00815 
<a name="l00816"></a><a class="code" href="a00175.html#fe26336ba3b3dbb8f0d87faefac0ddab">00816</a>     <a class="code" href="a00175.html#fe26336ba3b3dbb8f0d87faefac0ddab">TwoHopNeighborSet::TwoHopNeighborSet</a>()
<a name="l00817"></a>00817       : tset_(),
<a name="l00818"></a>00818         thnset_(*this, tset_)
<a name="l00819"></a>00819     {}
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <span class="keywordtype">void</span>
<a name="l00822"></a><a class="code" href="a00175.html#4a63c0a4faa843406113f85856ee60f5">00822</a>     <a class="code" href="a00175.html#4a63c0a4faa843406113f85856ee60f5">TwoHopNeighborSet::insert</a>(<span class="keyword">const</span> <a class="code" href="a00174.html">TwoHopNeighbor</a>&amp; x) {
<a name="l00823"></a>00823       std::pair&lt;tset_t::iterator, bool&gt; p = <a class="code" href="a00175.html#cecae41bf502a758fa99f3487e886295">tset_</a>.insert(x);
<a name="l00824"></a>00824       <span class="keywordflow">if</span> (!p.second) {
<a name="l00825"></a>00825         <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*        e = p.first-&gt;updater();
<a name="l00826"></a>00826         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#f41e7209a003243d0e0b15acc7ccf4d4">erase</a>(e);
<a name="l00827"></a>00827         e-&gt;<a class="code" href="a00168.html#3188e11b0e793a3c11b2018a25263942">set_next</a>(x.<a class="code" href="a00174.html#d445139951abe27bf0924bfa0b382187">time</a>());
<a name="l00828"></a>00828         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#98a2a5559ea1adb7bce7cc0e0609db5c">insert</a>(e);
<a name="l00829"></a>00829 
<a name="l00830"></a>00830         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">elem_t</a>&amp;<span class="keyword">&gt;</span>(*p.first).set_time(x.<a class="code" href="a00174.html#d445139951abe27bf0924bfa0b382187">time</a>());
<a name="l00831"></a>00831       } <span class="keywordflow">else</span> {
<a name="l00832"></a>00832         <span class="keywordflow">if</span> (<a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>.<a class="code" href="a00013.html#1af4b2b20849e6bc5c021f09d8dedbe6">sym_neighborset</a>().find(<a class="code" href="a00093.html#583ed09ee37bafb0a24c0e0570a53bc9">Neighbor::make_key</a>(<a class="code" href="a00290.html#30d8d67b523f48f9c84e0848072d1a2b">alg::main_addr_of</a>(x.<a class="code" href="a00174.html#106fc18e3e6841f20068ab7d9d7c208a">twohop_addr</a>()))) == <a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>.<a class="code" href="a00013.html#1af4b2b20849e6bc5c021f09d8dedbe6">sym_neighborset</a>().end())
<a name="l00833"></a>00833           <a class="code" href="a00289.html#93d438a99840d6124c2e415f4bc3c2a3">mprset_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00834"></a>00834         <a class="code" href="a00289.html#725e72b5f17434a9e7f942190f9289d3">routes_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00835"></a>00835         <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*        e = <span class="keyword">new</span> <a class="code" href="a00175.html#59b7ba68e4c829e9cff6cace7a364659">updater_t</a>(x.<a class="code" href="a00174.html#d445139951abe27bf0924bfa0b382187">time</a>(),
<a name="l00836"></a>00836                                                   <a class="code" href="a00175.html#dcba1348081b480c208d53d058cb1322">eraser_t</a>(*<span class="keyword">this</span>, p.first));
<a name="l00837"></a>00837         <span class="keyword">const_cast&lt;</span><a class="code" href="a00184.html">elem_t</a>&amp;<span class="keyword">&gt;</span>(*p.first).set_updater(e);
<a name="l00838"></a>00838         <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#98a2a5559ea1adb7bce7cc0e0609db5c">insert</a>(e);
<a name="l00839"></a>00839         <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#a5443506c3816c350c36d84e5c1b640b">insert_node</a>(<a class="code" href="a00004.html" title="A Node of the graph.">gra::AdjNode</a>(x.<a class="code" href="a00174.html#106fc18e3e6841f20068ab7d9d7c208a">twohop_addr</a>()));
<a name="l00840"></a>00840         <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#a972928401e34a7bbfd11a195158972f">insert_arc</a>(<a class="code" href="a00003.html" title="An arc of the graph.">gra::AdjInfo</a>(x.<a class="code" href="a00174.html#b99e028362be0ec5a232f3c1e9e209b3">main_addr</a>(),
<a name="l00841"></a>00841                                          x.<a class="code" href="a00174.html#106fc18e3e6841f20068ab7d9d7c208a">twohop_addr</a>(),
<a name="l00842"></a>00842                                          <a class="code" href="a00293.html#7333ecdb1e9a352b290b5aa5171cf89e23cc5ea3ac027657e96c6b7c0e2f063c">twohop</a>));
<a name="l00843"></a>00843       }
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846     <span class="keywordtype">void</span>
<a name="l00847"></a><a class="code" href="a00175.html#daa3597c1dba45306df36879f68e712a">00847</a>     <a class="code" href="a00175.html#daa3597c1dba45306df36879f68e712a">TwoHopNeighborSet::erase</a>(<span class="keyword">const</span> tset_t::iterator&amp; pos) {
<a name="l00848"></a>00848       assert(pos != <a class="code" href="a00175.html#cecae41bf502a758fa99f3487e886295">tset_</a>.end());
<a name="l00849"></a>00849       <span class="keywordtype">bool</span>      is_1hop_sym =
<a name="l00850"></a>00850         <a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>.<a class="code" href="a00013.html#1af4b2b20849e6bc5c021f09d8dedbe6">sym_neighborset</a>().find(<a class="code" href="a00093.html#583ed09ee37bafb0a24c0e0570a53bc9">Neighbor::make_key</a>(pos-&gt;twohop_addr()))
<a name="l00851"></a>00851         != <a class="code" href="a00289.html#94e9b2aeb3d1c993a91f2388d7bbdbd3">cproxy</a>.<a class="code" href="a00013.html#1af4b2b20849e6bc5c021f09d8dedbe6">sym_neighborset</a>().end();
<a name="l00852"></a>00852       <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#bec2971cb6df4fcd40bd0ed1082f1360">remove_arc</a>(<a class="code" href="a00003.html#a5a51001b77edc4895302d9e8d9d6348">gra::AdjInfo::make_key</a>(pos-&gt;main_addr(),
<a name="l00853"></a>00853                                                  pos-&gt;twohop_addr(),
<a name="l00854"></a>00854                                                  <a class="code" href="a00293.html#7333ecdb1e9a352b290b5aa5171cf89e23cc5ea3ac027657e96c6b7c0e2f063c">twohop</a>));
<a name="l00855"></a>00855       <span class="keywordflow">if</span> (!is_1hop_sym)
<a name="l00856"></a>00856         <a class="code" href="a00289.html#2315bc24f895d23a490f5566b56f45b2">path_net</a>.<a class="code" href="a00002.html#c02755f32025197620270dadbd0808db">remove_node_if_alone</a>(<a class="code" href="a00004.html#008824256f3231d3e08d3d40bd0e0d39">gra::AdjNode::make_key</a>(pos-&gt;twohop_addr()));
<a name="l00857"></a>00857       <span class="keywordflow">if</span> (!is_1hop_sym)
<a name="l00858"></a>00858         <a class="code" href="a00289.html#93d438a99840d6124c2e415f4bc3c2a3">mprset_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00859"></a>00859       <a class="code" href="a00289.html#725e72b5f17434a9e7f942190f9289d3">routes_recomp</a>.<a class="code" href="a00074.html#590d484157368e93a9a8fbddc6d40eb8">set_mark</a>();
<a name="l00860"></a>00860       <a class="code" href="a00168.html" title="Timed event abstract class.">sch::TimedEvent</a>*  e = pos-&gt;updater();
<a name="l00861"></a>00861       <a class="code" href="a00175.html#cecae41bf502a758fa99f3487e886295">tset_</a>.erase(pos);
<a name="l00862"></a>00862       <a class="code" href="a00289.html#f877be60c27b79ea1cfb70b4a73de1d3">scheduler</a>.<a class="code" href="a00147.html#108ff93e31982cfbddf7e3d4f3e2b352">destroy</a>(e);
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <span class="keywordtype">void</span>
<a name="l00866"></a><a class="code" href="a00175.html#a2b8ee66b1a5afb1097a6dd6ee3446a1">00866</a>     <a class="code" href="a00175.html#daa3597c1dba45306df36879f68e712a">TwoHopNeighborSet::erase</a>(<span class="keyword">const</span> tset_t::value_type&amp; x) {
<a name="l00867"></a>00867       tset_t::iterator  pos = <a class="code" href="a00175.html#cecae41bf502a758fa99f3487e886295">tset_</a>.find(x);
<a name="l00868"></a>00868       <span class="keywordflow">if</span> (pos != <a class="code" href="a00175.html#cecae41bf502a758fa99f3487e886295">tset_</a>.end())
<a name="l00869"></a>00869         <a class="code" href="a00175.html#daa3597c1dba45306df36879f68e712a">erase</a>(pos);
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872   } <span class="comment">// namespace set</span>
<a name="l00873"></a>00873 
<a name="l00874"></a>00874 } <span class="comment">// namespace olsr</span>
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="preprocessor">#endif // ! QOLYESTER_DAEMON_SET_NEIGHBORS_HXX</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Feb 12 20:45:36 2009 for Qolyester daemon by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
